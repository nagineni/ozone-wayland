From 1fb01e6a6c188e710790faae1afe7c0c285bec51 Mon Sep 17 00:00:00 2001
From: Sudarsana Nagineni <sudarsana.nagineni@intel.com>
Date: Wed, 27 May 2015 12:09:12 +0300
Subject: [PATCH] Allow libva Wayland rendering API to open VA driver inside
 the sandbox.

---
 content/common/sandbox_linux/bpf_gpu_policy_linux.cc | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/content/common/sandbox_linux/bpf_gpu_policy_linux.cc b/content/common/sandbox_linux/bpf_gpu_policy_linux.cc
index 2305780..7f0297d 100644
--- a/content/common/sandbox_linux/bpf_gpu_policy_linux.cc
+++ b/content/common/sandbox_linux/bpf_gpu_policy_linux.cc
@@ -256,6 +256,9 @@ ResultExpr GpuProcessPolicy::EvaluateSyscall(int sysno) const {
     case __NR_mprotect:
     // TODO(jln): restrict prctl.
     case __NR_prctl:
+#if defined(USE_OZONE)
+    case __NR_stat:
+#endif
       return Allow();
 #if !defined(__aarch64__)
     case __NR_access:
@@ -300,6 +303,8 @@ bool GpuProcessPolicy::PreSandboxHook() {
       if (IsArchitectureX86_64()) {
         if (access("/usr/lib64/dri/i965_dri.so", F_OK) !=-1)
           I965DrvVideoPath = "/usr/lib64/dri/i965_dri.so";
+        else if (access("/usr/lib/dri/i965_drv_video.so", F_OK) !=-1)
+          I965DrvVideoPath = "/usr/lib/dri/i965_drv_video.so";
         else
           I965DrvVideoPath = "/usr/lib64/va/drivers/i965_drv_video.so";
       } else if (IsArchitectureI386()) {
-- 
1.9.1

